<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compliance Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://mcp.figma.com/mcp/html-to-design/capture.js" async></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: #cbd5e1;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* ── Layout ── */
    .layout {
      display: flex;
      width: 100%;
      height: 100%;
      padding: 8px;
    }
    @media (max-width: 767px) {
      .layout { padding: 0; flex-direction: column; }
    }

    /* ── Main wrap ── */
    .main-wrap {
      flex: 1; min-width: 0; min-height: 0;
      padding-left: 4px;
      display: flex; flex-direction: column;
    }
    @media (max-width: 767px) { .main-wrap { padding-left: 0; } }

    /* ── Mobile header ── */
    .mob-header {
      display: none;
      background: #f1f5f9;
      padding: 16px 24px;
      align-items: center;
      gap: 16px;
      flex-shrink: 0;
    }
    @media (max-width: 767px) { .mob-header { display: flex; } }

    .ham-btn {
      background: none; border: none; cursor: pointer;
      padding: 0; color: #334155; flex-shrink: 0;
    }

    .mob-header-title {
      flex: 1;
      color: #334155;
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -1.12px;
      line-height: 34px;
    }

    /* ── Main panel ── */
    .main {
      background: #f1f5f9;
      border-radius: 8px;
      flex: 1; min-height: 0;
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    @media (max-width: 767px) { .main { border-radius: 0; } }

    /* ── Desktop page header ── */
    .page-header {
      background: #f1f5f9;
      padding: 24px;
      display: flex; align-items: center; gap: 16px;
      flex-shrink: 0;
    }
    @media (max-width: 767px) { .page-header { display: none; } }

    .page-title {
      flex: 1; color: #334155;
      font-size: 36px; font-weight: 600;
      letter-spacing: -1.44px; line-height: 40px;
    }

    /* ── Buttons ── */
    .btn-primary {
      background: #2c66ef; color: #fff;
      font-size: 14px; font-weight: 500;
      letter-spacing: -0.56px; line-height: 24px;
      padding: 4px 12px 4px 8px; border-radius: 8px;
      border: none; cursor: pointer;
      display: flex; align-items: center; gap: 10px;
      flex-shrink: 0; white-space: nowrap;
    }
    .btn-primary:hover { background: #1d56df; }
    .btn-soft {
      background: #ccdafb; color: #2c66ef;
      font-size: 14px; font-weight: 500;
      letter-spacing: -0.56px; line-height: 24px;
      padding: 4px 12px 4px 8px; border-radius: 8px;
      border: none; cursor: pointer;
      display: flex; align-items: center; gap: 10px;
      flex-shrink: 0; white-space: nowrap;
    }
    .btn-soft:hover { background: #b8ccf8; }
    .btn-outline {
      border: 1px solid #2c66ef; color: #2c66ef;
      background: #fff;
      font-size: 14px; font-weight: 500;
      letter-spacing: -0.56px; line-height: 24px;
      padding: 4px 12px; border-radius: 8px;
      cursor: pointer; flex-shrink: 0; white-space: nowrap;
    }

    /* ── Status pills ── */
    .status-pill {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 6px; border-radius: 12px;
      font-size: 12px; font-weight: 600;
      letter-spacing: -0.24px; line-height: 16px;
      width: fit-content;
    }
    .status-pill .dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
    .status-approved { background: #a7f3d0; color: #059669; }
    .status-approved .dot { background: #059669; }
    .status-in-review { background: #bfdbfe; color: #2563eb; }
    .status-in-review .dot { background: #2563eb; }

    /* ── Summary section ── */
    .summary-section { flex-shrink: 0; }
    .summary-card {
      background: #fff;
      padding: 24px;
      display: flex; align-items: center; gap: 32px;
      height: 96px;
    }
    .summary-info { flex: 1; display: flex; flex-direction: column; gap: 8px; }
    .summary-title {
      color: #0f172a; font-size: 16px; font-weight: 600;
      letter-spacing: -0.32px; line-height: 20px;
    }

    /* ── Table section ── */
    .table-section {
      display: flex; flex-direction: column;
      padding-top: 24px; /* gap from summary card */
      flex: 1; min-height: 0;
    }
    .table-wrap {
      background: #fff;
      display: flex; flex-direction: column;
      flex: 1; min-height: 0; overflow: hidden;
    }
    .table-toolbar {
      padding: 24px 24px 0;
      display: flex; align-items: center; gap: 4px;
      flex-shrink: 0;
    }
    .table-toolbar-title {
      color: #0f172a; font-size: 16px; font-weight: 600;
      letter-spacing: -0.32px; line-height: 26px;
      flex-shrink: 0; width: 180px;
    }
    .filter-select {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 12px;
      border: 1px solid #cbd5e1; border-radius: 8px;
      background: #fff; cursor: pointer;
    }
    .filter-label {
      color: #334155; font-size: 16px; font-weight: 400;
      line-height: 20px; white-space: nowrap;
    }
    .table-inner {
      padding: 24px;
      flex: 1; min-height: 0;
      display: flex; flex-direction: column;
      overflow: hidden;
    }

    /* ── Scrollable table container ── */
    .table-scroll-wrap {
      flex: 1; min-height: 0;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
    }

    /* ── Data table ── */
    .data-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 520px;
    }

    /* Header row — sticky top */
    .data-table th {
      background: #f1f5f9;
      color: #64748b;
      font-size: 14px; font-weight: 600;
      letter-spacing: -0.28px; line-height: 18px;
      padding: 16px;
      text-align: left;
      white-space: nowrap;
      position: sticky;
      top: 0;
      z-index: 2;
      border-bottom: 1px solid #e2e8f0;
    }

    /* Data cells */
    .data-table td {
      padding: 16px;
      vertical-align: middle;
      background: #fff;
      border-bottom: 1px solid #e2e8f0;
    }
    .data-table tbody tr:last-child td { border-bottom: none; }

    /* Column separators */
    .data-table th + th,
    .data-table td + td { border-left: 1px solid #e2e8f0; }

    /* Sticky first column (Name) */
    .data-table th:first-child {
      position: sticky; left: 0; z-index: 3;
      box-shadow: 2px 0 4px -2px rgba(0,0,0,0.08);
    }
    .data-table td:first-child {
      position: sticky; left: 0; z-index: 1;
      background: #fff;
      box-shadow: 2px 0 4px -2px rgba(0,0,0,0.08);
    }

    /* Row hover */
    .data-table tr:hover td { background: #f4f7fe; }
    .data-table tr:hover td:first-child { background: #f4f7fe; }

    /* ── Table cell content ── */
    .name-cell {
      display: flex; align-items: center;
      gap: 8px; white-space: nowrap;
    }
    .compliance-icon {
      width: 24px; height: 24px; border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; padding: 2px;
    }
    .compliance-icon.non-compliant { background: #fecaca; }
    .compliance-icon.compliant { background: #a7f3d0; }

    .name-text {
      color: #0f172a; font-size: 16px; font-weight: 600;
      letter-spacing: -0.32px; line-height: 20px; white-space: nowrap;
    }
    .non-compliant-badge {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 6px; background: #fecaca; border-radius: 12px;
      white-space: nowrap;
    }
    .non-compliant-badge span {
      color: #dc2626; font-size: 12px; font-weight: 600;
      letter-spacing: -0.24px; line-height: 16px;
    }
    .activity-text {
      color: #0f172a; font-size: 16px; font-weight: 400;
      letter-spacing: -0.32px; line-height: 20px; white-space: nowrap;
    }
    .activity-dash {
      color: #0f172a; font-size: 16px; font-weight: 600;
      letter-spacing: -0.32px; line-height: 20px;
    }

    /* ── Add Person Drawer ── */
    .ap-overlay {
      display: none;
      position: fixed; inset: 0; top: 40px;
      background: rgba(0,0,0,0.4);
      z-index: 200;
    }
    .ap-overlay.is-visible { display: block; }

    .ap-drawer {
      position: fixed;
      top: 40px; right: 0; bottom: 0;
      width: 440px; max-width: 100vw;
      background: #fff;
      z-index: 201;
      display: flex; flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      box-shadow: -4px 0 24px rgba(0,0,0,0.12);
    }
    .ap-drawer.is-open { transform: translateX(0); }
    @media (max-width: 767px) { .ap-drawer { width: 100%; } }

    .ap-header {
      display: flex; align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid #e2e8f0;
      flex-shrink: 0; background: #f1f5f9;
    }
    .ap-title {
      flex: 1;
      font-size: 20px; font-weight: 600;
      letter-spacing: -0.4px; line-height: 26px;
      color: #334155;
    }
    .ap-close {
      background: none; border: none; cursor: pointer;
      color: #64748b; padding: 4px;
      display: flex; align-items: center;
    }
    .ap-close:hover { color: #0f172a; }

    .ap-body { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }

    .ap-section {
      padding: 24px;
      display: flex; flex-direction: column; gap: 20px;
      background: #fff;
    }
    .ap-section.ap-section-gray {
      background: #f8fafc;
      border-top: 1px solid #e2e8f0;
      flex: 1;
    }
    .ap-section-head { display: flex; flex-direction: column; gap: 4px; }
    .ap-section-title {
      font-size: 24px; font-weight: 600;
      letter-spacing: -0.48px; line-height: 26px; color: #334155;
    }
    .ap-section-sub { font-size: 16px; color: #0f172a; line-height: 18px; letter-spacing: -0.32px; }

    .ap-field { display: flex; flex-direction: column; gap: 6px; }
    .ap-label {
      font-size: 14px; font-weight: 500;
      color: #334155; letter-spacing: -0.28px; line-height: 20px;
    }
    .ap-input {
      width: 100%; padding: 10px 14px;
      border: 1px solid #cbd5e1; border-radius: 8px;
      font-family: inherit; font-size: 15px;
      color: #0f172a; line-height: 22px;
      outline: none; background: #fff;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .ap-input:focus {
      border-color: #2c66ef;
      box-shadow: 0 0 0 3px rgba(44,102,239,0.1);
    }
    .ap-select {
      width: 100%; padding: 10px 40px 10px 14px;
      border: 1px solid #cbd5e1; border-radius: 8px;
      font-family: inherit; font-size: 15px;
      color: #0f172a; line-height: 22px;
      outline: none; background: #fff; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232c66ef' stroke-width='2.5' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 14px center;
      cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s;
    }
    .ap-select:focus {
      border-color: #2c66ef;
      box-shadow: 0 0 0 3px rgba(44,102,239,0.1);
    }

    .ap-notify-row { display: flex; align-items: flex-start; gap: 12px; }
    .ap-checkbox {
      width: 20px; height: 20px; flex-shrink: 0;
      accent-color: #2c66ef; margin-top: 2px; cursor: pointer;
    }
    .ap-notify-label {
      display: block;
      font-size: 15px; font-weight: 600; color: #0f172a; line-height: 22px;
      cursor: pointer;
    }
    .ap-notify-desc { font-size: 13px; color: #64748b; line-height: 18px; margin-top: 3px; }

    .ap-footer {
      padding: 16px 24px;
      border-top: 1px solid #e2e8f0;
      display: flex; flex-direction: column; gap: 12px;
      flex-shrink: 0; background: #fff;
    }
    .ap-btn-cancel {
      background: #fff; border: 1px solid #e2e8f0;
      color: #334155; font-family: inherit;
      font-size: 16px; font-weight: 500;
      padding: 13px 16px; border-radius: 8px; cursor: pointer;
      width: 100%; justify-content: center;
    }
    .ap-btn-cancel:hover { background: #f8fafc; }
    .ap-btn-add {
      background: #2c66ef; border: none;
      color: #fff; font-family: inherit;
      font-size: 16px; font-weight: 500;
      padding: 13px 16px; border-radius: 8px; cursor: pointer;
      display: flex; align-items: center; gap: 8px;
      width: 100%; justify-content: center;
    }
    .ap-btn-add:hover { background: #1d56df; }

    /* ── Compliance Detail Drawer ── */
    .cd-overlay {
      display: none;
      position: fixed; inset: 0; top: 40px;
      background: rgba(0,0,0,0.4);
      z-index: 200;
    }
    .cd-overlay.is-visible { display: block; }

    .cd-drawer {
      position: fixed;
      top: 40px; right: 0; bottom: 0;
      width: 440px; max-width: 100vw;
      background: #fff;
      z-index: 201;
      display: flex; flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      box-shadow: -4px 0 24px rgba(0,0,0,0.12);
    }
    .cd-drawer.is-open { transform: translateX(0); }
    @media (max-width: 767px) { .cd-drawer { width: 100%; } }

    .cd-header {
      display: flex; align-items: center; gap: 12px;
      padding: 16px 24px;
      border-bottom: 1px solid #e2e8f0;
      flex-shrink: 0; background: #f1f5f9;
    }
    .cd-header-identity { display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0; }
    .cd-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: #64748b; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 14px; font-weight: 600;
    }
    .cd-header-text { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .cd-person-name {
      font-size: 16px; font-weight: 600;
      color: #0f172a; letter-spacing: -0.32px; line-height: 22px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .cd-person-sub { font-size: 12px; color: #64748b; line-height: 17px; }
    .cd-status-badge {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 8px; border-radius: 12px;
      font-size: 12px; font-weight: 600; line-height: 16px; white-space: nowrap;
    }
    .cd-status-badge.non-compliant { background: #fecaca; color: #dc2626; }
    .cd-status-badge.compliant { background: #a7f3d0; color: #059669; }
    .cd-status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }
    .cd-close {
      background: none; border: none; cursor: pointer;
      color: #64748b; padding: 4px;
      display: flex; align-items: center;
    }
    .cd-close:hover { color: #0f172a; }

    .cd-body { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }

    .cd-banner {
      background: #fef3c7;
      padding: 12px 24px;
      display: flex; align-items: flex-start; gap: 8px;
      border-bottom: 1px solid #fde68a;
      flex-shrink: 0;
    }
    .cd-banner-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 1px; color: #92400e; }
    .cd-banner-text { font-size: 13px; color: #000; letter-spacing: -0.28px; line-height: 18px; }

    .cd-section {
      padding: 20px 24px;
      border-bottom: 1px solid #e2e8f0;
      display: flex; flex-direction: column; gap: 14px;
    }
    .cd-section:last-child { border-bottom: none; }
    .cd-section-head { display: flex; flex-direction: column; gap: 4px; }
    .cd-section-title { font-size: 24px; font-weight: 600; color: #334155; letter-spacing: -0.48px; line-height: 26px; }
    .cd-section-sub { font-size: 16px; color: #0f172a; line-height: 18px; letter-spacing: -0.32px; }

    /* Inline-edit fields */
    .cd-field { display: flex; flex-direction: column; gap: 4px; }
    .cd-field-label {
      font-size: 16px; font-weight: 600;
      color: #0f172a; letter-spacing: -0.32px; line-height: 26px;
    }
    .cd-field-label .req { color: #ef4444; }
    .cd-field-value-wrap { display: flex; align-items: center; gap: 8px; width: 100%; }
    .cd-field-value { font-size: 16px; font-weight: 400; color: #0f172a; line-height: 26px; flex: 1; }
    .cd-edit-btn {
      background: none; border: none; cursor: pointer;
      padding: 0; flex-shrink: 0;
      display: flex; align-items: center;
      color: #2c66ef;
    }
    .cd-edit-btn:hover { opacity: 0.75; }
    .cd-edit-btn svg { width: 20px; height: 20px; }
    /* Inline edit form */
    .edit-form { display: flex; flex-direction: column; gap: 8px; width: 100%; }
    .edit-input {
      width: 100%; padding: 10px 12px;
      border: 1px solid #cbd5e1; border-radius: 8px;
      font-family: inherit; font-size: 16px; font-weight: 400;
      color: #0f172a; letter-spacing: -0.32px; line-height: 22px;
      outline: none; background: #fff;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .edit-input:focus { border-color: #2c66ef; box-shadow: 0 0 0 3px rgba(44,102,239,0.1); }
    .edit-actions { display: flex; align-items: center; gap: 8px; justify-content: flex-end; }
    .btn-cancel-inline {
      background: #e2e8f0; border: none; color: #0f172a;
      font-family: inherit; font-size: 14px; font-weight: 500;
      letter-spacing: -0.28px; line-height: 20px;
      padding: 4px 12px; border-radius: 8px; cursor: pointer;
    }
    .btn-cancel-inline:hover { background: #cbd5e1; }
    .btn-save-inline {
      background: #2c66ef; border: none; color: #fff;
      font-family: inherit; font-size: 14px; font-weight: 500;
      letter-spacing: -0.28px; line-height: 20px;
      padding: 4px 12px; border-radius: 8px; cursor: pointer;
      display: flex; align-items: center; gap: 6px;
    }
    .btn-save-inline:disabled { background: #cbd5e1; cursor: not-allowed; }

    /* Requirements iframe */
    .cd-iframe-wrap {
      width: 100%; height: 460px;
      border-radius: 8px; border: 1px solid #e2e8f0;
      overflow: hidden; position: relative;
      background: #f8fafc;
    }
    .cd-iframe-wrap iframe {
      position: absolute; top: 0; left: 0;
      border: none; transform-origin: top left;
    }

    /* Send link */
    .cd-send-btns { display: flex; gap: 10px; flex-wrap: wrap; }
    .cd-btn-secondary {
      background: #fff; border: 1px solid #e2e8f0;
      color: #334155; font-family: inherit;
      font-size: 13px; font-weight: 500;
      padding: 7px 14px; border-radius: 8px; cursor: pointer;
      display: inline-flex; align-items: center; gap: 6px;
      transition: background 0.15s;
    }
    .cd-btn-secondary:hover { background: #f1f5f9; }
    .cd-btn-secondary svg { width: 15px; height: 15px; }

    /* Direct link */
    .cd-link-box {
      background: #f8fafc; border: 1px solid #e2e8f0;
      border-radius: 8px; padding: 10px 14px;
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 11.5px; color: #334155;
      line-height: 17px; word-break: break-all;
    }
    .cd-btn-copy {
      background: #2c66ef; color: #fff;
      border: none; font-family: inherit;
      font-size: 13px; font-weight: 500;
      padding: 7px 14px; border-radius: 8px; cursor: pointer;
      display: inline-flex; align-items: center; gap: 6px;
      align-self: flex-start; transition: background 0.15s;
    }
    .cd-btn-copy:hover { background: #1d56df; }
    .cd-btn-copy.copied { background: #059669; }
    .cd-btn-copy svg { width: 14px; height: 14px; }

    /* Danger zone */
    .cd-danger-label {
      font-size: 10px; font-weight: 700;
      color: #dc2626; letter-spacing: 0.8px; text-transform: uppercase;
    }
    .cd-danger-box {
      border: 1px solid #fecaca; border-radius: 8px;
      padding: 16px; display: flex; flex-direction: column; gap: 10px;
    }
    .cd-btn-deactivate {
      background: #dc2626; color: #fff;
      border: none; font-family: inherit;
      font-size: 13px; font-weight: 500;
      padding: 7px 14px; border-radius: 8px; cursor: pointer;
      align-self: flex-start; transition: background 0.15s;
    }
    .cd-btn-deactivate:hover { background: #b91c1c; }

    /* ── Deactivate confirmation modal ── */
    .deact-backdrop {
      display: none;
      position: fixed; inset: 0; top: 40px;
      background: rgba(0,0,0,0.45);
      z-index: 400;
      align-items: center;
      justify-content: center;
    }
    .deact-backdrop.is-visible { display: flex; }
    .deact-modal {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      width: 320px;
      max-width: calc(100vw - 32px);
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    }
    .deact-title {
      font-size: 16px; font-weight: 600;
      color: #0f172a; letter-spacing: -0.32px; line-height: 24px;
    }
    .deact-body {
      font-size: 14px; font-weight: 400;
      color: #475569; letter-spacing: -0.28px; line-height: 20px;
    }
    .deact-btns {
      display: flex; gap: 8px; justify-content: flex-end; margin-top: 4px;
    }
    .deact-btn-cancel {
      background: #fff; color: #0f172a;
      border: 1px solid #e2e8f0; border-radius: 8px;
      padding: 6px 14px; font-family: inherit;
      font-size: 14px; font-weight: 500;
      letter-spacing: -0.28px; cursor: pointer;
      transition: background 0.15s;
    }
    .deact-btn-cancel:hover { background: #f1f5f9; }
    .deact-btn-confirm {
      background: #dc2626; color: #fff;
      border: none; border-radius: 8px;
      padding: 6px 14px; font-family: inherit;
      font-size: 14px; font-weight: 500;
      letter-spacing: -0.28px; cursor: pointer;
      transition: background 0.15s;
    }
    .deact-btn-confirm:hover { background: #b91c1c; }

    /* Clickable compliance rows */
    .data-table tbody tr { cursor: pointer; }

    /* ── Overall Company Compliance drawer ── */
    .oc-overlay {
      display: none;
      position: fixed; inset: 0; top: 40px;
      background: rgba(0,0,0,0.4);
      z-index: 200;
    }
    .oc-overlay.is-visible { display: block; }

    .oc-drawer {
      position: fixed;
      top: 40px; right: 0; bottom: 0;
      width: 440px; max-width: 100vw;
      background: #fff;
      z-index: 201;
      display: flex; flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      box-shadow: -4px 0 24px rgba(0,0,0,0.12);
    }
    .oc-drawer.is-open { transform: translateX(0); }
    @media (max-width: 767px) { .oc-drawer { width: 100%; } }

    .oc-header {
      display: flex; align-items: center; gap: 12px;
      padding: 16px 24px;
      border-bottom: 1px solid #e2e8f0;
      flex-shrink: 0; background: #f1f5f9;
    }
    .oc-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: #2c66ef; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 14px; font-weight: 600;
    }
    .oc-header-text { display: flex; flex-direction: column; gap: 1px; min-width: 0; flex: 1; }
    .oc-company-name {
      font-size: 16px; font-weight: 600;
      color: #0f172a; letter-spacing: -0.32px; line-height: 22px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .oc-close {
      background: none; border: none; cursor: pointer;
      color: #64748b; padding: 4px; flex-shrink: 0;
      display: flex; align-items: center;
    }
    .oc-close:hover { color: #0f172a; }

    .oc-body { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }

    .oc-banner {
      background: #fef3c7;
      padding: 12px 24px;
      display: flex; align-items: flex-start; gap: 8px;
      border-bottom: 1px solid #fde68a;
      flex-shrink: 0;
    }
    .oc-banner-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 1px; color: #92400e; }
    .oc-banner-text { font-size: 13px; color: #000; letter-spacing: -0.28px; line-height: 18px; }

    .oc-section {
      padding: 20px 24px;
      display: flex; flex-direction: column; gap: 14px;
      flex: 1;
    }
    .oc-section-title { font-size: 24px; font-weight: 600; color: #334155; letter-spacing: -0.48px; line-height: 26px; }
    .oc-section-sub { font-size: 16px; color: #0f172a; line-height: 18px; letter-spacing: -0.32px; }

    .oc-iframe-wrap {
      width: 100%; height: 460px;
      border-radius: 8px; border: 1px solid #e2e8f0;
      overflow: hidden; position: relative;
      background: #f8fafc;
    }
    .oc-iframe-wrap iframe {
      position: absolute; top: 0; left: 0;
      border: none; transform-origin: top left;
    }

    /* ── Notification banner ── */
    .notif-banner {
      position: fixed;
      top: 56px; /* 40px nav + 16px gap */
      right: 24px;
      width: 428px;
      max-width: calc(100vw - 32px);
      background: #fff;
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.06);
      z-index: 500;
      transform: translateX(calc(100% + 48px));
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
      pointer-events: none;
    }
    .notif-banner.is-visible {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }
    .notif-icon { width: 20px; height: 20px; flex-shrink: 0; }
    .notif-icon svg { width: 20px; height: 20px; }
    .notif-body { display: flex; flex-direction: column; gap: 3px; flex: 1; min-width: 0; }
    .notif-msg {
      font-size: 14px; font-weight: 600;
      color: #0f172a; letter-spacing: -0.28px; line-height: 20px;
    }
    .notif-dismiss {
      background: none; border: none; cursor: pointer;
      font-family: inherit; font-size: 13px; font-weight: 500;
      color: #2c66ef; padding: 0; text-align: left; width: fit-content;
    }
    .notif-dismiss:hover { text-decoration: underline; }

    /* ── Prototype Nav Bar ── */
    .proto-nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 9999;
      height: 40px;
      background: #000;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 16px;
      font-family: 'Inter', system-ui, sans-serif;
    }
    .proto-nav-library {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: -0.28px;
      line-height: 24px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .proto-nav-library:hover { opacity: 0.75; }
    .proto-nav-library svg { width: 20px; height: 20px; flex-shrink: 0; }
    .proto-nav-title {
      flex: 1;
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: -0.28px;
      line-height: 24px;
    }
    .proto-nav-updated {
      flex: 1;
      color: #fff;
      font-size: 14px;
      font-weight: 400;
      letter-spacing: -0.28px;
      line-height: 24px;
      text-align: right;
      white-space: nowrap;
    }
    body { padding-top: 40px; }

    /* ── Shared avatars in compliance table ── */
    .shared-avatars { display: flex; align-items: center; }
    .shared-avatars .sa {
      width: 26px; height: 26px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 9px; font-weight: 700; color: #fff;
      border: 2px solid #fff; margin-left: -6px; flex-shrink: 0;
    }
    .shared-avatars .sa:first-child { margin-left: 0; }
    .sa-blue { background: #2c66ef; }
    .sa-purple { background: #7c3aed; }
    .sa-teal { background: #0d9488; }
    .sa-orange { background: #ea580c; }

    /* Row context menu */
    .row-action-cell { width: 36px; padding: 0 4px !important; }
    .row-ctx { position: relative; display: flex; align-items: center; justify-content: center; }
    .row-ctx-btn {
      background: none; border: none; cursor: pointer; padding: 4px;
      color: #94a3b8; border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity 0.15s;
      width: 28px; height: 28px;
    }
    .data-table tbody tr:hover .row-ctx-btn { opacity: 1; }
    .row-ctx-btn:hover { background: #f1f5f9; color: #334155; }
    .row-ctx-btn svg { width: 18px; height: 18px; }
    .ctx-menu {
      display: none; position: absolute;
      top: calc(100% + 4px); right: 0;
      background: #fff; border: 1px solid #e2e8f0;
      border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      min-width: 160px; z-index: 100; padding: 4px;
    }
    .ctx-menu.is-open { display: block; }
    .ctx-menu-item {
      display: block; width: 100%; background: none; border: none;
      padding: 8px 12px; text-align: left; font-family: inherit;
      font-size: 14px; font-weight: 400; color: #334155;
      cursor: pointer; border-radius: 6px;
      letter-spacing: -0.28px; line-height: 20px;
    }
    .ctx-menu-item:hover { background: #f8fafc; }

    /* "Or share via" in Direct Link section */
    .cd-share-via { display: flex; align-items: center; gap: 10px; }
    .cd-share-via-label {
      font-size: 13px; color: #94a3b8;
      font-weight: 400; letter-spacing: -0.26px; white-space: nowrap;
    }

    /* Share Compliance Profile section */
    .cd-secure-link-header { display: flex; align-items: center; gap: 8px; }
    .cd-active-badge {
      background: #dcfce7; color: #16a34a;
      font-size: 11px; font-weight: 600;
      padding: 2px 8px; border-radius: 12px;
      letter-spacing: 0.3px; line-height: 16px;
    }
    .cd-share-action-btns { display: flex; gap: 8px; }
    .cd-btn-copy-sec {
      flex: 1; background: #2c66ef; color: #fff;
      border: none; font-family: inherit;
      font-size: 13px; font-weight: 500;
      padding: 7px 14px; border-radius: 8px; cursor: pointer;
      display: inline-flex; align-items: center; justify-content: center; gap: 6px;
      transition: background 0.15s; letter-spacing: -0.26px;
    }
    .cd-btn-copy-sec:hover { background: #1d56df; }
    .cd-btn-copy-sec svg { width: 14px; height: 14px; }
    .cd-btn-revoke {
      flex: 1; background: #fff;
      border: 1px solid #e2e8f0; color: #dc2626;
      font-family: inherit; font-size: 13px; font-weight: 500;
      padding: 7px 14px; border-radius: 8px; cursor: pointer;
      display: inline-flex; align-items: center; justify-content: center; gap: 6px;
      transition: background 0.15s, border-color 0.15s; letter-spacing: -0.26px;
    }
    .cd-btn-revoke:hover { background: #fef2f2; border-color: #fca5a5; }
    .cd-shared-with-label {
      font-size: 12px; font-weight: 600; color: #94a3b8;
      letter-spacing: 0.5px; text-transform: uppercase; line-height: 16px;
      margin-bottom: 6px;
    }
    .cd-shared-org-list { display: flex; flex-direction: column; gap: 8px; }
    .cd-shared-org-row {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; background: #f8fafc;
      border: 1px solid #e2e8f0; border-radius: 8px;
    }
    .cd-org-avatar {
      width: 32px; height: 32px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 700; color: #fff; flex-shrink: 0;
    }
    .cd-org-info { flex: 1; min-width: 0; }
    .cd-org-name { font-size: 14px; font-weight: 500; color: #0f172a; letter-spacing: -0.28px; line-height: 20px; }
    .cd-org-remaining { font-size: 12px; color: #94a3b8; letter-spacing: -0.24px; line-height: 17px; }
    .cd-btn-renew {
      background: #fff; border: 1px solid #e2e8f0; color: #2c66ef;
      font-family: inherit; font-size: 12px; font-weight: 500;
      padding: 5px 10px; border-radius: 6px; cursor: pointer;
      white-space: nowrap; letter-spacing: -0.24px; line-height: 17px; flex-shrink: 0;
    }
    .cd-btn-renew:hover { background: #eff6ff; border-color: #bfdbfe; }

    /* ── Global context menu (right-click + ... button) ── */
    .ctx-menu-global {
      display: none; position: fixed;
      background: #fff; border: 1px solid #e2e8f0;
      border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      min-width: 164px; z-index: 1000; padding: 4px;
    }
    .ctx-menu-global.is-visible { display: block; }
    .ctx-menu-global .ctx-menu-item {
      display: flex; align-items: center; gap: 8px;
      width: 100%; background: none; border: none;
      padding: 8px 12px; text-align: left; font-family: inherit;
      font-size: 14px; font-weight: 400; color: #334155;
      cursor: pointer; border-radius: 6px;
      letter-spacing: -0.28px; line-height: 20px;
    }
    .ctx-menu-global .ctx-menu-item:hover { background: #f8fafc; }
    .ctx-menu-global .ctx-menu-item svg { width: 16px; height: 16px; flex-shrink: 0; color: #64748b; }

    /* ── Share Modal ── */
    .share-backdrop {
      display: none; position: fixed; inset: 0; top: 40px;
      background: rgba(0,0,0,0.45); z-index: 600;
      align-items: center; justify-content: center;
    }
    .share-backdrop.is-visible { display: flex; }
    .share-modal {
      background: #fff; border-radius: 12px; padding: 24px;
      width: 464px; max-width: calc(100vw - 32px); position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      max-height: calc(100vh - 80px); overflow-y: auto;
    }
    .share-modal-close {
      position: absolute; top: 16px; right: 16px;
      background: none; border: none; cursor: pointer;
      color: #64748b; padding: 4px; border-radius: 4px;
      display: flex; align-items: center;
    }
    .share-modal-close:hover { color: #0f172a; }
    .share-modal-title {
      font-size: 24px; font-weight: 600; color: #334155;
      letter-spacing: -0.48px; line-height: 26px; padding-right: 32px;
    }
    .share-modal-sub {
      font-size: 16px; color: #0f172a; letter-spacing: -0.32px;
      line-height: 18px; margin-top: 16px; margin-bottom: 24px;
    }
    .share-form { display: flex; flex-direction: column; gap: 16px; }
    .share-field { display: flex; flex-direction: column; gap: 4px; }
    .share-label { font-size: 16px; font-weight: 600; color: #0f172a; letter-spacing: -0.32px; line-height: 26px; }
    .share-select {
      width: 100%; padding: 9px 36px 9px 12px;
      border: 2px solid #cbd5e1; border-radius: 8px;
      font-family: inherit; font-size: 16px; color: #0f172a;
      letter-spacing: -0.32px; line-height: 22px;
      outline: none; background: #fff; cursor: pointer; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 12px center;
      transition: border-color 0.15s;
    }
    .share-select:focus { border-color: #2c66ef; box-shadow: 0 0 0 3px rgba(44,102,239,0.1); }
    .email-tags-wrap {
      border: 1px solid #cbd5e1; border-radius: 8px;
      padding: 7px 12px; background: #fff;
      display: flex; flex-wrap: wrap; gap: 6px;
      align-content: flex-start; cursor: text;
      min-height: 42px;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .email-tags-wrap:focus-within {
      border-color: #2c66ef;
      box-shadow: 0 0 0 3px rgba(44,102,239,0.1);
    }
    .email-input-field {
      border: none; outline: none; background: transparent;
      font-family: inherit; font-size: 16px; font-weight: 400;
      color: #0f172a; letter-spacing: -0.32px; line-height: 26px;
      flex: 1; min-width: 140px; padding: 0;
    }
    .email-input-field::placeholder { color: #94a3b8; }
    .email-tag {
      display: inline-flex; align-items: center; gap: 5px;
      background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px;
      padding: 3px 8px; font-size: 13px; color: #334155;
      letter-spacing: -0.26px; line-height: 20px;
    }
    .email-tag-x {
      background: none; border: none; cursor: pointer; padding: 0;
      color: #94a3b8; display: flex; align-items: center; font-size: 14px; line-height: 1;
    }
    .email-tag-x:hover { color: #334155; }
    .share-field-hint {
      font-size: 12px; color: #94a3b8; letter-spacing: -0.24px; line-height: 16px;
    }
    .btn-share-action {
      width: 100%; margin-top: 16px; padding: 8px 12px;
      background: #2c66ef; border: none; color: #fff;
      font-family: inherit; font-size: 14px; font-weight: 500;
      letter-spacing: -0.28px; line-height: 24px; border-radius: 8px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      transition: background 0.15s;
    }
    .btn-share-action:hover { background: #1d56df; }
    .share-creds-section { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
    .share-creds-label { font-size: 16px; font-weight: 600; color: #0f172a; letter-spacing: -0.32px; line-height: 26px; }
    .share-creds-box {
      border: 1px solid #cbd5e1; border-radius: 8px;
      padding: 12px 8px 16px 16px; display: flex; gap: 8px; align-items: flex-start;
    }
    .share-creds-inner { flex: 1; display: flex; flex-direction: column; gap: 16px; }
    .share-creds-actions { display: flex; gap: 16px; }
    .share-creds-action {
      background: none; border: none; padding: 0; cursor: pointer;
      font-family: inherit; font-size: 16px; color: #2c66ef;
      letter-spacing: -0.32px; line-height: 26px;
    }
    .share-creds-action:hover { text-decoration: underline; }
    .share-cred-item { display: flex; align-items: center; gap: 16px; cursor: pointer; }
    .share-cred-item input[type="checkbox"] {
      appearance: none; -webkit-appearance: none; flex-shrink: 0;
      width: 20px; height: 20px; border: 1.5px solid #2c66ef;
      border-radius: 4px; cursor: pointer; position: relative;
      transition: background 0.15s;
    }
    .share-cred-item input[type="checkbox"]:checked { background: #2c66ef; border-color: #2c66ef; }
    .share-cred-item input[type="checkbox"]:checked::after {
      content: ''; position: absolute;
      left: 5px; top: 2px; width: 7px; height: 11px;
      border: 2px solid #fff; border-top: none; border-left: none;
      transform: rotate(45deg);
    }
    .share-cred-label { font-size: 16px; font-weight: 500; color: #0f172a; letter-spacing: -0.32px; line-height: 20px; }
    .share-creds-scrollbar { width: 4px; background: #cbd5e1; border-radius: 2px; height: 62px; flex-shrink: 0; margin-top: 42px; }
    .btn-share-action svg { width: 16px; height: 16px; }
    /* Share modal shared view */
    .share-secure-box {
      border: 1px solid #e2e8f0; border-radius: 8px;
      padding: 16px 20px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 24px;
    }
    .share-secure-top { display: flex; align-items: center; justify-content: space-between; }
    .share-secure-label { font-size: 14px; font-weight: 600; color: #334155; letter-spacing: -0.28px; }
    .share-secure-status { display: flex; align-items: center; gap: 5px; font-size: 12px; font-weight: 500; color: #16a34a; }
    .share-secure-dot { width: 8px; height: 8px; border-radius: 50%; background: #16a34a; }
    .share-secure-url { font-family: 'SF Mono','Fira Code',monospace; font-size: 11px; color: #334155; line-height: 16px; word-break: break-all; }
    .share-secure-btns { display: flex; gap: 8px; }
    .btn-sec-copy, .btn-sec-revoke {
      flex: 1; padding: 7px 12px; border: 1px solid #e2e8f0; background: #fff;
      border-radius: 6px; cursor: pointer; font-family: inherit;
      font-size: 13px; font-weight: 500;
      display: flex; align-items: center; justify-content: center; gap: 6px;
      letter-spacing: -0.26px; line-height: 20px; transition: background 0.15s;
    }
    .btn-sec-copy { color: #334155; }
    .btn-sec-copy:hover { background: #f8fafc; }
    .btn-sec-revoke { color: #64748b; }
    .btn-sec-revoke:hover { background: #f8fafc; }
    .btn-sec-copy svg, .btn-sec-revoke svg { width: 14px; height: 14px; }
    .share-shared-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .share-shared-label { font-size: 11px; font-weight: 700; color: #94a3b8; letter-spacing: 0.8px; text-transform: uppercase; white-space: nowrap; }
    .share-shared-line { flex: 1; height: 1px; background: #e2e8f0; }
    .share-shared-org-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
    .share-shared-org-row + .share-shared-org-row { border-top: 1px solid #f1f5f9; }
    .share-org-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; color: #fff; flex-shrink: 0; }
    .share-org-name { flex: 1; font-size: 14px; font-weight: 500; color: #0f172a; letter-spacing: -0.28px; line-height: 20px; min-width: 0; }
    .share-org-remaining { font-size: 13px; color: #64748b; letter-spacing: -0.26px; white-space: nowrap; }
    .share-org-revoke-btn {
      display: none; background: #fff; border: 1px solid #e2e8f0; color: #64748b;
      font-family: inherit; font-size: 13px; font-weight: 500;
      padding: 5px 10px; border-radius: 6px; cursor: pointer;
      align-items: center; gap: 6px; letter-spacing: -0.26px; line-height: 18px; white-space: nowrap;
    }
    .share-org-revoke-btn svg { width: 14px; height: 14px; }
    .share-shared-org-row:hover .share-org-remaining { display: none; }
    .share-shared-org-row:hover .share-org-revoke-btn { display: inline-flex; }
    .share-org-revoke-btn:hover { background: #f8fafc; }
  </style>
</head>
<body>
  <!-- Prototype nav bar -->
  <nav class="proto-nav">
    <span class="proto-nav-title">Prototype / Portal</span>
    <button data-map-key="portal" class="proto-nav-library proto-nav-map">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
      </svg>
      Map
    </button>
    <a href="index.html" class="proto-nav-library">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
      </svg>
      Library
    </a>
    <span class="proto-nav-updated" id="protoLastUpdated" style="flex:0 0 auto;"></span>
  </nav>

  <!-- Main layout -->
  <div class="layout">

    <div id="sidebarMount" data-active="compliance"></div>

    <!-- Main content -->
    <div class="main-wrap">

      <!-- Mobile header -->
      <div class="mob-header">
        <button class="ham-btn" onclick="openSidebar()" aria-label="Open menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        <span class="mob-header-title">Compliance</span>
        <button class="btn-soft" style="font-size:13px; padding:4px 8px; gap:6px;" onclick="openAddPerson()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          Add
        </button>
        <button class="btn-primary" style="font-size:13px; padding:4px 8px; gap:6px;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
          </svg>
          CSV
        </button>
      </div>

      <div class="main">

        <!-- Desktop page header -->
        <div class="page-header">
          <h1 class="page-title">Compliance</h1>
          <button class="btn-soft" onclick="openAddPerson()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            Add an employee
          </button>
          <button class="btn-primary">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
            </svg>
            Import CSV
          </button>
        </div>

        <!-- Summary card -->
        <div class="summary-section">
          <div class="summary-card">
            <div class="summary-info">
              <div class="summary-title">Overall Company Compliance</div>
              <div class="status-pill status-approved">
                <span class="dot"></span>
                Approved
              </div>
            </div>
            <button class="btn-outline" onclick="openCompanyCompliance()">View</button>
          </div>
        </div>

        <!-- Table section -->
        <div class="table-section">
          <div class="table-wrap">
            <div class="table-toolbar">
              <div class="table-toolbar-title">Compliance Status</div>
              <div class="filter-select">
                <span class="filter-label">Show all</span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#334155" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
              </div>
            </div>
            <div class="table-inner">
              <div class="table-scroll-wrap">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Status</th>
                      <th>Last activity</th>
                      <th>Shared with</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon non-compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                              <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                            </svg>
                          </div>
                          <span class="name-text">Martin Saris</span>
                        </div>
                      </td>
                      <td>
                        <div class="non-compliant-badge">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                          </svg>
                          <span>Non-compliant</span>
                        </div>
                      </td>
                      <td><span class="activity-dash">-</span></td>
                      <td><div class="shared-avatars"></div></td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon non-compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                              <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                            </svg>
                          </div>
                          <span class="name-text">Jaylon Bergson</span>
                        </div>
                      </td>
                      <td>
                        <div class="non-compliant-badge">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                          </svg>
                          <span>Non-compliant</span>
                        </div>
                      </td>
                      <td><span class="activity-dash">-</span></td>
                      <td><div class="shared-avatars"></div></td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon non-compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                              <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                            </svg>
                          </div>
                          <span class="name-text">Cullen Burke</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-in-review">
                          <span class="dot"></span>
                          In review
                        </div>
                      </td>
                      <td><span class="activity-dash">-</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon non-compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M10 6v5M10 14h.01" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>
                              <circle cx="10" cy="10" r="8" stroke="#dc2626" stroke-width="1.5"/>
                            </svg>
                          </div>
                          <span class="name-text">Foster Clemons</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-in-review">
                          <span class="dot"></span>
                          In review
                        </div>
                      </td>
                      <td><span class="activity-dash">-</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Carter Peters</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">15 Feb, 11:00AM</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Marcus Workman</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">15 Feb, 3:00PM</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Jamison Whitfield A...</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">12 Feb, 10:00AM</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Ekstrom Bothman</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">1 Jan, 11:00AM</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Martin Vetrovs</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">24 Dec 2024</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Alfredo Stanton</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">12 Dec 2024</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Ruben Korsgaard</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">1 Dec 2024</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-orange" title="Bolton Clarke">BC</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Alfredo Dias</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">18 Oct 2024</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="name-cell">
                          <div class="compliance-icon compliant">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M5 10l4 4 7-7" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </div>
                          <span class="name-text">Davis Dias</span>
                        </div>
                      </td>
                      <td>
                        <div class="status-pill status-approved">
                          <span class="dot"></span>
                          Approved
                        </div>
                      </td>
                      <td><span class="activity-text">12 Aug 2024</span></td>
                      <td>
                        <div class="shared-avatars">
                          <span class="sa sa-purple" title="Wallaby Health">WH</span>
                          <span class="sa sa-teal" title="Catholic Healthcare">CH</span>
                        </div>
                      </td>
                      <td class="row-action-cell" onclick="event.stopPropagation()">
                        <div class="row-ctx">
                          <button class="row-ctx-btn" onclick="openRowCtxMenu(this)" aria-label="More options">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="12" cy="19" r="1.5"/></svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Global context menu -->
  <div id="globalCtxMenu" class="ctx-menu-global">
    <button class="ctx-menu-item" onclick="ctxViewDetails()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
      View details
    </button>
    <button class="ctx-menu-item" onclick="ctxShare()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      Share
    </button>
  </div>

  <!-- Add Person overlay + drawer -->
  <div class="ap-overlay" id="apOverlay" onclick="closeAddPerson()"></div>

  <aside class="ap-drawer" id="apDrawer">
    <div class="ap-header">
      <button class="ap-close" onclick="closeAddPerson()" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      <span class="ap-title">Add person</span>
    </div>

    <div class="ap-body">

      <!-- Details section -->
      <div class="ap-section">
        <div class="ap-section-head">
          <div class="ap-section-title">Details</div>
          <div class="ap-section-sub">Employee will be invited via Email or SMS</div>
        </div>
        <div class="ap-field">
          <label class="ap-label" for="ap-fname">Legal First Name</label>
          <input class="ap-input" id="ap-fname" type="text" placeholder="Enter first name" />
        </div>
        <div class="ap-field">
          <label class="ap-label" for="ap-lname">Legal Last Name</label>
          <input class="ap-input" id="ap-lname" type="text" placeholder="Enter last name" />
        </div>
        <div class="ap-field">
          <label class="ap-label" for="ap-phone">Phone</label>
          <input class="ap-input" id="ap-phone" type="tel" placeholder="Enter phone number" />
        </div>
        <div class="ap-field">
          <label class="ap-label" for="ap-email">Email</label>
          <input class="ap-input" id="ap-email" type="email" placeholder="Enter email address" />
        </div>
        <div class="ap-field">
          <label class="ap-label" for="ap-role">Role</label>
          <select class="ap-select" id="ap-role">
            <option value="" disabled selected>Select a role</option>
            <option value="plumber">Plumber</option>
            <option value="electrician">Electrician</option>
            <option value="carpenter">Carpenter</option>
            <option value="manager">Manager</option>
          </select>
        </div>
      </div>

      <!-- Notifications section -->
      <div class="ap-section ap-section-gray">
        <div class="ap-section-title">Notifications</div>
        <div class="ap-notify-row">
          <input class="ap-checkbox" type="checkbox" id="ap-invite" checked />
          <div>
            <label class="ap-notify-label" for="ap-invite">Send compliance invite now</label>
            <div class="ap-notify-desc">Immediately notify this contractor to provide their compliance documents</div>
          </div>
        </div>
      </div>

    </div>

    <div class="ap-footer">
      <button class="ap-btn-add">
        Add
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
        </svg>
      </button>
      <button class="ap-btn-cancel" onclick="closeAddPerson()">Cancel</button>
    </div>
  </aside>

  <!-- Compliance Detail overlay + drawer -->
  <div class="cd-overlay" id="cdOverlay" onclick="closeCompliance()"></div>

  <aside class="cd-drawer" id="cdDrawer">

    <!-- Header -->
    <div class="cd-header">
      <button class="cd-close" onclick="closeCompliance()" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      <div class="cd-header-identity">
        <div class="cd-avatar" id="cdAvatar">MW</div>
        <div class="cd-header-text">
          <div class="cd-person-name" id="cdPersonName">Marcus Workman</div>
          <div class="cd-person-sub">Platypus Plumbing</div>
        </div>
      </div>
      <span class="cd-status-badge non-compliant" id="cdStatusBadge">
        <span class="cd-status-dot"></span> Non-compliant
      </span>
    </div>

    <!-- Scrollable body -->
    <div class="cd-body">

      <!-- Yellow info banner -->
      <div class="cd-banner">
        <svg class="cd-banner-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="11" width="14" height="10" rx="2"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 11V7a4 4 0 018 0v4"/>
        </svg>
        <span class="cd-banner-text">Information you provided will only be shared with Wallaby Aged Care.</span>
      </div>

      <!-- Details section -->
      <div class="cd-section">
        <div class="cd-section-head">
          <div class="cd-section-title">Details</div>
          <div class="cd-section-sub">Your employee details. The selected role will determine what is required to keep this employee compliant.</div>
        </div>
        <div class="cd-field">
          <span class="cd-field-label">Legal First Name</span>
          <div class="cd-field-value-wrap" data-fieldtype="text" data-fieldmaxlen="100">
            <span class="cd-field-value">Marcus</span>
            <button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            </button>
          </div>
        </div>
        <div class="cd-field">
          <span class="cd-field-label">Legal Last Name</span>
          <div class="cd-field-value-wrap" data-fieldtype="text" data-fieldmaxlen="100">
            <span class="cd-field-value">Workman</span>
            <button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            </button>
          </div>
        </div>
        <div class="cd-field">
          <span class="cd-field-label">Phone</span>
          <div class="cd-field-value-wrap" data-fieldtype="tel" data-fieldmaxlen="20">
            <span class="cd-field-value">0411 111 111</span>
            <button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            </button>
          </div>
        </div>
        <div class="cd-field">
          <span class="cd-field-label">Email</span>
          <div class="cd-field-value-wrap" data-fieldtype="email" data-fieldmaxlen="200">
            <span class="cd-field-value">workman.marcus@platypusplumbing.com.au</span>
            <button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            </button>
          </div>
        </div>
        <div class="cd-field">
          <span class="cd-field-label">Role</span>
          <div class="cd-field-value-wrap" data-fieldtype="text" data-fieldmaxlen="100">
            <span class="cd-field-value">Plumber</span>
            <button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Requirements section (worker app iframe) -->
      <div class="cd-section">
        <div class="cd-section-head">
          <div class="cd-section-title">Requirements</div>
          <div class="cd-section-sub">Add the requirements below to stay compliant.</div>
        </div>
        <div class="cd-iframe-wrap" id="cdIframeWrap">
          <iframe id="cdReqIframe" src="mobile-requirements.html" title="Requirements" scrolling="yes"></iframe>
        </div>
      </div>

      <!-- Direct Link section (combined with send via) -->
      <div class="cd-section">
        <div class="cd-section-head">
          <div class="cd-section-title">Direct Link</div>
          <div class="cd-section-sub">Share this link to allow <span id="cdLinkName">Marcus Workman</span> to upload their compliance requirements directly.</div>
        </div>
        <div class="cd-link-box" id="cdDirectLink">https://staging-demo.zipline.app/staff-member/uldcH6/JhHb/myxlhlq/62Bbt10303l3</div>
        <button class="cd-btn-copy" id="cdCopyBtn" onclick="copyDirectLink()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copy Link
        </button>
        <div class="cd-share-via">
          <span class="cd-share-via-label">Or share via</span>
          <button class="cd-btn-secondary" onclick="showBanner('email')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            Email
          </button>
          <button class="cd-btn-secondary" onclick="showBanner('sms')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
            SMS
          </button>
        </div>
      </div>

      <!-- Share Compliance Profile section -->
      <div class="cd-section">
        <div class="cd-section-head">
          <div class="cd-section-title">Share Compliance Profile</div>
          <div class="cd-section-sub">Share your compliance profile as a secure link with hiring companies.</div>
        </div>
        <div class="cd-secure-link-header">
          <span style="font-size:14px; font-weight:600; color:#334155; letter-spacing:-0.28px;">Secure Link</span>
          <span class="cd-active-badge">Active</span>
        </div>
        <div class="cd-link-box">https://staging-demo.zipline.app/profile/share/xK9mP2qR7vN5tL8wA3...</div>
        <div class="cd-share-action-btns">
          <button class="cd-btn-copy-sec" onclick="copyShareLink(this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
            Copy Link
          </button>
          <button class="cd-btn-revoke">Revoke all access</button>
        </div>
        <div>
          <div class="cd-shared-with-label">Shared with</div>
          <div class="cd-shared-org-list">
            <div class="cd-shared-org-row">
              <div class="cd-org-avatar sa-purple">WH</div>
              <div class="cd-org-info">
                <div class="cd-org-name">Wallaby Health</div>
                <div class="cd-org-remaining">2 days remaining</div>
              </div>
              <button class="cd-btn-renew">Renew access</button>
            </div>
            <div class="cd-shared-org-row">
              <div class="cd-org-avatar sa-teal">CH</div>
              <div class="cd-org-info">
                <div class="cd-org-name">Catholic Healthcare</div>
                <div class="cd-org-remaining">3 days remaining</div>
              </div>
              <button class="cd-btn-renew">Renew access</button>
            </div>
            <div class="cd-shared-org-row">
              <div class="cd-org-avatar sa-orange">BC</div>
              <div class="cd-org-info">
                <div class="cd-org-name">Bolton Clarke</div>
                <div class="cd-org-remaining">4 days remaining</div>
              </div>
              <button class="cd-btn-renew">Renew access</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="cd-section">
        <div class="cd-danger-label">DANGER ZONE</div>
        <div class="cd-danger-box">
          <div class="cd-section-title">Deactivate profile</div>
          <div class="cd-section-sub">Deactivating profile will prevent them to come on-site and perform jobs.</div>
          <button class="cd-btn-deactivate" onclick="openDeactivateModal()">Deactivate</button>
        </div>
      </div>

    </div>
  </aside>

  <!-- Share Modal -->
  <div class="share-backdrop" id="shareBackdrop" onclick="closeShareModal()">
    <div class="share-modal" onclick="event.stopPropagation()">
      <button class="share-modal-close" onclick="closeShareModal()" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>

      <!-- Form view -->
      <div id="shareFormView">
        <div class="share-modal-title">Share Compliance Profile</div>
        <div class="share-modal-sub">Share a link to this profile with external providers.</div>
        <div class="share-creds-section">
          <div class="share-creds-label">Share Credentials</div>
          <div class="share-creds-box">
            <div class="share-creds-inner">
              <div class="share-creds-actions">
                <button class="share-creds-action" onclick="selectAllCreds(true)">Select all</button>
                <button class="share-creds-action" onclick="selectAllCreds(false)">Deselect all</button>
              </div>
              <label class="share-cred-item">
                <input type="checkbox" name="cred" checked>
                <span class="share-cred-label">Nationally Coordinated Criminal History Check</span>
              </label>
              <label class="share-cred-item">
                <input type="checkbox" name="cred" checked>
                <span class="share-cred-label">Plumbing License</span>
              </label>
              <label class="share-cred-item">
                <input type="checkbox" name="cred" checked>
                <span class="share-cred-label">Australian Working Rights</span>
              </label>
              <label class="share-cred-item">
                <input type="checkbox" name="cred">
                <span class="share-cred-label">Working With Children Check</span>
              </label>
            </div>
            <div class="share-creds-scrollbar"></div>
          </div>
        </div>
        <div class="share-form">
          <div class="share-field">
            <label class="share-label" for="shareDuration">Link valid for</label>
            <select class="share-select" id="shareDuration">
              <option value="1week">1 week</option>
              <option value="2weeks">2 weeks</option>
              <option value="1month">1 month</option>
              <option value="3months">3 months</option>
            </select>
          </div>
          <div class="share-field">
            <label class="share-label" for="shareWith">Share with</label>
            <select class="share-select" id="shareWith" onchange="toggleShareWith(this.value)">
              <option value="anyone">Anyone with a link</option>
              <option value="specific">Specific people</option>
            </select>
          </div>
          <div class="share-field" id="emailInviteField" style="display:none">
            <label class="share-label">Invite via email</label>
            <div class="email-tags-wrap" id="emailTagsWrap" onclick="document.getElementById('emailInput').focus()">
              <input class="email-input-field" id="emailInput" type="text" placeholder="e.g. email@gmail.com" onkeydown="handleEmailKeydown(event)" />
            </div>
            <p class="share-field-hint">Press Enter or comma after each email address to add it.</p>
          </div>
        </div>
        <button class="btn-share-action" id="shareBtn" onclick="submitShare()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          Share
        </button>
      </div>

      <!-- Shared view (shown after sharing) -->
      <div id="shareSharedView" style="display:none">
        <div class="share-modal-title">Share Compliance Profile</div>
        <div class="share-modal-sub">Share a link to this profile with external providers.</div>
        <div class="share-secure-box">
          <div class="share-secure-top">
            <span class="share-secure-label">Secure Link</span>
            <span class="share-secure-status"><span class="share-secure-dot"></span>Active</span>
          </div>
          <div class="share-secure-url">https://staging-demo.zipline.app/staff-members/pQIs9KLI6Bt6vXxgdNhQ/%2B61333123123</div>
          <div class="share-secure-btns">
            <button class="btn-sec-copy" onclick="copyModalLink(this)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
              Copy Link
            </button>
            <button class="btn-sec-revoke">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
              Revoke all access
            </button>
          </div>
        </div>
        <div class="share-shared-header">
          <span class="share-shared-label">Shared with</span>
          <span class="share-shared-line"></span>
        </div>
        <div>
          <div class="share-shared-org-row">
            <div class="share-org-avatar" style="background:#16a34a">WH</div>
            <span class="share-org-name">Wallaby Health</span>
            <span class="share-org-remaining">2 days remaining</span>
            <button class="share-org-revoke-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
              Revoke access
            </button>
          </div>
          <div class="share-shared-org-row">
            <div class="share-org-avatar" style="background:#dc2626">CH</div>
            <span class="share-org-name">Catholic Healthcare</span>
            <span class="share-org-remaining">3 days remaining</span>
            <button class="share-org-revoke-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
              Revoke access
            </button>
          </div>
          <div class="share-shared-org-row">
            <div class="share-org-avatar" style="background:#7c3aed">BC</div>
            <span class="share-org-name">Bolton Clarke</span>
            <span class="share-org-remaining">4 days remaining</span>
            <button class="share-org-revoke-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
              Revoke access
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Notification banner -->
  <div class="notif-banner" id="notifBanner">
    <div class="notif-icon" id="notifIcon"></div>
    <div class="notif-body">
      <span class="notif-msg" id="notifMsg"></span>
      <button class="notif-dismiss" onclick="dismissBanner()">Dismiss</button>
    </div>
  </div>

  <!-- Deactivate confirmation modal -->
  <div class="deact-backdrop" id="deactBackdrop">
    <div class="deact-modal">
      <div class="deact-title">Deactivate this profile?</div>
      <div class="deact-body">Deactivating profile will prevent them to come on-site and perform jobs.</div>
      <div class="deact-btns">
        <button class="deact-btn-cancel" onclick="closeDeactivateModal()">Cancel</button>
        <button class="deact-btn-confirm" onclick="confirmDeactivate()">Deactivate</button>
      </div>
    </div>
  </div>

  <!-- Overall Company Compliance overlay + drawer -->
  <div class="oc-overlay" id="ocOverlay" onclick="closeCompanyCompliance()"></div>

  <aside class="oc-drawer" id="ocDrawer">
    <div class="oc-header">
      <button class="oc-close" onclick="closeCompanyCompliance()" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      <div class="oc-avatar">PP</div>
      <div class="oc-header-text">
        <span class="oc-company-name">Platypus Plumbing</span>
        <div class="cd-status-badge non-compliant" style="margin-top:2px; width:fit-content;">
          <span class="cd-status-dot"></span>Non-compliant
        </div>
      </div>
    </div>

    <div class="oc-body">
      <!-- Info banner -->
      <div class="oc-banner">
        <svg class="oc-banner-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 11V7a5 5 0 0110 0v4"/>
        </svg>
        <span class="oc-banner-text">Information you provided will only be shared with Wallaby Aged Care.</span>
      </div>

      <!-- Requirements section -->
      <div class="oc-section">
        <div>
          <div class="oc-section-title">Requirements</div>
          <div class="oc-section-sub" style="margin-top:4px;">Add the requirements below to stay compliant.</div>
        </div>
        <div class="oc-iframe-wrap" id="ocIframeWrap">
          <iframe id="ocReqIframe" src="mobile-requirements.html" title="Requirements" scrolling="yes"></iframe>
        </div>
      </div>
    </div>
  </aside>

  <script>

    function openAddPerson() {
      document.getElementById('apDrawer').classList.add('is-open');
      document.getElementById('apOverlay').classList.add('is-visible');
    }
    function closeAddPerson() {
      document.getElementById('apDrawer').classList.remove('is-open');
      document.getElementById('apOverlay').classList.remove('is-visible');
    }

    // ── Compliance Detail Drawer ─────────────────────────────────────────────
    function openCompliance(rowEl) {
      const name = rowEl.querySelector('.name-text').textContent.trim();
      document.getElementById('cdPersonName').textContent = name;
      document.getElementById('cdLinkName').textContent = name;
      const initials = name.split(' ').map(function(w){ return w[0]; }).join('').toUpperCase().slice(0, 2);
      document.getElementById('cdAvatar').textContent = initials;

      // Close add-person drawer if open
      document.getElementById('apDrawer').classList.remove('is-open');
      document.getElementById('apOverlay').classList.remove('is-visible');

      document.getElementById('cdDrawer').classList.add('is-open');
      document.getElementById('cdOverlay').classList.add('is-visible');
      scaleCdIframe();
    }
    function closeCompliance() {
      document.getElementById('cdDrawer').classList.remove('is-open');
      document.getElementById('cdOverlay').classList.remove('is-visible');
    }
    function openDeactivateModal() {
      document.getElementById('deactBackdrop').classList.add('is-visible');
    }
    function closeDeactivateModal() {
      document.getElementById('deactBackdrop').classList.remove('is-visible');
    }
    function confirmDeactivate() {
      closeDeactivateModal();
      closeCompliance();
      showBanner('deactivated');
    }

    // Notification banner
    var notifTimer = null;
    var BANNER_ICONS = {
      email: {
        color: '#10b981',
        svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>'
      },
      sms: {
        color: '#10b981',
        svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>'
      },
      deactivated: {
        color: '#334155',
        svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>'
      }
    };
    var BANNER_MSGS = {
      email: 'Email has been sent to Markus Workman.',
      sms: 'SMS has been sent to Markus Workman.',
      deactivated: "Markus Workman\u2019s profile has been deactivated."
    };
    function showBanner(type) {
      clearTimeout(notifTimer);
      var banner = document.getElementById('notifBanner');
      var iconEl = document.getElementById('notifIcon');
      var msgEl = document.getElementById('notifMsg');
      var def = BANNER_ICONS[type];
      iconEl.innerHTML = def.svg;
      iconEl.style.color = def.color;
      msgEl.textContent = BANNER_MSGS[type];
      // Reset then trigger so it re-animates if already visible
      banner.classList.remove('is-visible');
      void banner.offsetWidth; // force reflow
      banner.classList.add('is-visible');
      notifTimer = setTimeout(dismissBanner, 5000);
    }
    function dismissBanner() {
      clearTimeout(notifTimer);
      document.getElementById('notifBanner').classList.remove('is-visible');
    }

    // ── Overall Company Compliance Drawer ────────────────────────────────────
    function openCompanyCompliance() {
      document.getElementById('ocDrawer').classList.add('is-open');
      document.getElementById('ocOverlay').classList.add('is-visible');
      scaleOcIframe();
    }
    function closeCompanyCompliance() {
      document.getElementById('ocDrawer').classList.remove('is-open');
      document.getElementById('ocOverlay').classList.remove('is-visible');
    }
    function scaleOcIframe() {
      var wrap   = document.getElementById('ocIframeWrap');
      var iframe = document.getElementById('ocReqIframe');
      var containerW = wrap.clientWidth;
      var nativeW = 375;
      var scale = containerW / nativeW;
      iframe.style.width  = nativeW + 'px';
      iframe.style.height = Math.ceil(460 / scale) + 'px';
      iframe.style.transform = 'scale(' + scale + ')';
    }
    window.addEventListener('resize', function() {
      if (document.getElementById('ocDrawer').classList.contains('is-open')) scaleOcIframe();
    });

    function scaleCdIframe() {
      var wrap   = document.getElementById('cdIframeWrap');
      var iframe = document.getElementById('cdReqIframe');
      var containerW = wrap.clientWidth;
      var nativeW = 375;
      var scale = containerW / nativeW;
      iframe.style.width  = nativeW + 'px';
      iframe.style.height = Math.ceil(460 / scale) + 'px';
      iframe.style.transform = 'scale(' + scale + ')';
    }
    window.addEventListener('resize', function() {
      if (document.getElementById('cdDrawer').classList.contains('is-open')) scaleCdIframe();
    });

    // Make compliance table rows clickable
    document.querySelectorAll('.data-table tbody tr').forEach(function(row) {
      row.addEventListener('click', function() { openCompliance(row); });
    });

    // ── Global context menu (right-click + ... button) ─────────────────────
    var _ctxTargetRow = null;

    function showGlobalCtxMenu(x, y, row) {
      _ctxTargetRow = row;
      var menu = document.getElementById('globalCtxMenu');
      menu.classList.remove('is-visible');
      menu.style.left = x + 'px';
      menu.style.top = y + 'px';
      menu.classList.add('is-visible');
      // Adjust if clipped by viewport edges
      var rect = menu.getBoundingClientRect();
      if (rect.right > window.innerWidth - 8) menu.style.left = (x - rect.width) + 'px';
      if (rect.bottom > window.innerHeight - 8) menu.style.top = (y - rect.height) + 'px';
    }

    function openRowCtxMenu(btn) {
      var row = btn.closest('tr');
      var rect = btn.getBoundingClientRect();
      showGlobalCtxMenu(rect.right, rect.bottom + 4, row);
    }

    function closeCtxMenu() {
      document.getElementById('globalCtxMenu').classList.remove('is-visible');
    }

    // Right-click on table rows
    document.querySelector('.data-table tbody').addEventListener('contextmenu', function(e) {
      var row = e.target.closest('tr');
      if (!row) return;
      e.preventDefault();
      showGlobalCtxMenu(e.clientX, e.clientY, row);
    });

    document.addEventListener('click', function(e) {
      if (!e.target.closest('#globalCtxMenu') && !e.target.closest('.row-ctx-btn')) {
        closeCtxMenu();
      }
    });

    function ctxViewDetails() {
      closeCtxMenu();
      if (_ctxTargetRow) openCompliance(_ctxTargetRow);
    }

    function ctxShare() {
      closeCtxMenu();
      openShareModal();
    }

    // ── Share Modal ──────────────────────────────────────────────────────────
    function openShareModal() {
      document.getElementById('shareFormView').style.display = '';
      document.getElementById('shareSharedView').style.display = 'none';
      document.getElementById('shareWith').value = 'anyone';
      document.getElementById('emailInviteField').style.display = 'none';
      // Clear any tags from previous open
      document.querySelectorAll('#emailTagsWrap .email-tag').forEach(function(t) { t.remove(); });
      document.getElementById('emailInput').value = '';
      document.getElementById('shareBtn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> Share';
      document.getElementById('shareBackdrop').classList.add('is-visible');
    }

    function selectAllCreds(checked) {
      document.querySelectorAll('#shareFormView input[name="cred"]').forEach(function(cb) {
        cb.checked = checked;
      });
    }

    function closeShareModal() {
      document.getElementById('shareBackdrop').classList.remove('is-visible');
    }

    function toggleShareWith(val) {
      document.getElementById('emailInviteField').style.display = val === 'specific' ? '' : 'none';
      updateShareBtn();
    }

    function updateShareBtn() {
      var btn = document.getElementById('shareBtn');
      var shareIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>';
      if (document.getElementById('shareWith').value === 'specific') {
        var count = document.querySelectorAll('#emailTagsWrap .email-tag').length;
        btn.innerHTML = shareIcon + ' Share with ' + count + ' ' + (count === 1 ? 'person' : 'people');
      } else {
        btn.innerHTML = shareIcon + ' Share';
      }
    }

    function handleEmailKeydown(e) {
      if (e.key === 'Enter' || e.key === ',') {
        e.preventDefault();
        var val = e.target.value.trim().replace(/,$/, '');
        if (!val) return;
        var wrap = document.getElementById('emailTagsWrap');
        var input = document.getElementById('emailInput');
        var tag = document.createElement('span');
        tag.className = 'email-tag';
        tag.innerHTML = val + ' <button class="email-tag-x" onclick="removeEmailTag(this)">&#x2715;</button>';
        wrap.insertBefore(tag, input);
        e.target.value = '';
        updateShareBtn();
      } else if (e.key === 'Backspace' && !e.target.value) {
        var tags = document.querySelectorAll('#emailTagsWrap .email-tag');
        if (tags.length > 0) { tags[tags.length - 1].remove(); updateShareBtn(); }
      }
    }

    function removeEmailTag(xBtn) {
      xBtn.closest('.email-tag').remove();
      updateShareBtn();
    }

    function submitShare() {
      document.getElementById('shareFormView').style.display = 'none';
      document.getElementById('shareSharedView').style.display = '';
    }

    function copyModalLink(btn) {
      navigator.clipboard.writeText('https://staging-demo.zipline.app/staff-members/pQIs9KLI6Bt6vXxgdNhQ/%2B61333123123').then(function() {
        var orig = btn.innerHTML;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg> Copied!';
        setTimeout(function() { btn.innerHTML = orig; }, 2000);
      });
    }

    // Copy secure share link (from drawer)
    function copyShareLink(btn) {
      navigator.clipboard.writeText('https://staging-demo.zipline.app/profile/share/xK9mP2qR7vN5tL8wA3').then(function() {
        var orig = btn.innerHTML;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg> Copied!';
        setTimeout(function() { btn.innerHTML = orig; }, 2000);
      });
    }

    // Inline editing (matches company-details.html pattern)
    function cdEsc(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
    function startEdit(btn) {
      var wrap = btn.closest('.cd-field-value-wrap');
      if (wrap.dataset.editing) return;
      var valueEl = wrap.querySelector('.cd-field-value');
      var originalVal = valueEl ? valueEl.textContent.trim() : '';
      var inputType = wrap.dataset.fieldtype || 'text';
      var maxLen = parseInt(wrap.dataset.fieldmaxlen) || 200;
      wrap.dataset.editing = '1';
      wrap.dataset.original = originalVal;
      wrap.innerHTML =
        '<div class="edit-form">' +
          '<input type="' + inputType + '" class="edit-input" value="' + cdEsc(originalVal) + '" maxlength="' + maxLen + '">' +
          '<div class="edit-actions">' +
            '<button class="btn-cancel-inline" onclick="cancelCdEdit(this)">Cancel</button>' +
            '<button class="btn-save-inline" onclick="saveCdEdit(this)">Save ' +
              '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>' +
            '</button>' +
          '</div>' +
        '</div>';
      var input = wrap.querySelector('.edit-input');
      input.focus();
      input.setSelectionRange(input.value.length, input.value.length);
    }
    function saveCdEdit(btn) {
      var wrap = btn.closest('.cd-field-value-wrap');
      var input = wrap.querySelector('.edit-input');
      var val = input.value.trim() || wrap.dataset.original;
      delete wrap.dataset.editing;
      renderCdView(wrap, val);
    }
    function cancelCdEdit(btn) {
      var wrap = btn.closest('.cd-field-value-wrap');
      delete wrap.dataset.editing;
      renderCdView(wrap, wrap.dataset.original || '');
    }
    function renderCdView(wrap, value) {
      wrap.innerHTML =
        '<span class="cd-field-value">' + cdEsc(value) + '</span>' +
        '<button class="cd-edit-btn" onclick="startEdit(this)" title="Edit">' +
          '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>' +
        '</button>';
    }

    // Copy direct link
    function copyDirectLink() {
      var text = document.getElementById('cdDirectLink').textContent.trim();
      navigator.clipboard.writeText(text).then(function() {
        var btn = document.getElementById('cdCopyBtn');
        btn.classList.add('copied');
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg> Copied!';
        setTimeout(function() {
          btn.classList.remove('copied');
          btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy Link';
        }, 2000);
      });
    }

  </script>
  <script>
    document.getElementById('protoLastUpdated').textContent = 'Last updated 28/02/2026 15:45:29';
  </script>
  <script src="sidebar.js"></script>
  <script src="sidebar-logo.js"></script>
  <script src="sidebar-profile.js"></script>
  <script>if(window.self!==window.top){var n=document.querySelector(".proto-nav");if(n)n.style.display="none";document.body.style.paddingTop="0";}</script>
  <script src="map-modal.js"></script>
</body>
</html>
